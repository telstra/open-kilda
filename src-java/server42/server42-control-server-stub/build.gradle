plugins {
    id "org.springframework.boot" version "3.2.0"
}

configurations {
    // This conflicts with spring-boot-starter-log4j2
    implementation.exclude module: "spring-boot-starter-logging"
}

configurations.configureEach {
    //LoggerFactory is not a Logback LoggerContext but Logback is on the classpath. Either remove Logback or the competing implementation
    exclude group: "ch.qos.logback", module: "logback-classic"
    exclude group: "ch.qos.logback", module: "logback-core"
}

dependencies {
    implementation(platform("org.springframework:spring-framework-bom:6.0.6"))
    implementation(platform("org.springframework.boot:spring-boot-dependencies:3.1.0"))

    implementation(project(":server42-control-messaging"))
    implementation(project(":server42-stats-messaging"))

    implementation("com.google.protobuf:protobuf-java:3.22.3")
    implementation("org.zeromq:jeromq:0.4.3")
    implementation("joda-time:joda-time:2.10.13")

    implementation("com.fasterxml.jackson.core:jackson-core")
    implementation("com.fasterxml.jackson.datatype:jackson-datatype-joda")

    implementation("org.springframework.boot:spring-boot-starter")
    implementation("org.springframework.boot:spring-boot-starter-log4j2")

    compileOnly("org.projectlombok:lombok")
    annotationProcessor("org.projectlombok:lombok")
    annotationProcessor("org.projectlombok:lombok-mapstruct-binding")
}

bootJar {
    mainClass = "org.openkilda.server42.control.serverstub.ServerApplication"
    archiveFileName = "${archivesBaseName}.${archiveExtension.get()}"
}

bootJar.dependsOn generateVersionTxt

## Create operation

REST endpoint: `POST /v2/y-flows`

request payload:

```json
{
  "shared_endpoint": {
    "switch_id": "00:00:00:00:00:00:00:01",
    "port_number": 0
  },
  "maximum_bandwidth": 0,
  "path_computation_strategy": "strategy-name",
  "encapsulation_type": "encapsulation-name",
  "max_latency": 0,
  "max_latency_tier2": 0,
  "ignore_bandwidth": true,
  "periodic_pings": false,
  "pinned": false,
  "priority": 0,
  "strict_bandwidth": true,
  "description": "description"
  "sub_flows": [
    {
      "endpoint": {
        "switch_id": "00:00:00:00:00:00:00:02",
        "port_number": 0,
        "vlan_id": 0,
        "inner_vlan_id": 0
      },
      "shared_endpoint": {
        "vlan_id": 0,
        "inner_vlan_id": 0
      },
      "description": "description"
    },
    {
      "endpoint": {
        "switch_id": "00:00:00:00:00:00:00:03",
        "port_number": 0,
        "vlan_id": 0,
        "inner_vlan_id": 0
      },
      "shared_endpoint": {
        "vlan_id": 0,
        "inner_vlan_id": 0
      },
      "description": "description"
    }
  ]
} 
```

response payload (copy of request payload plus autogenerated fields):

```json
{
  "y_flow_id": "yf-AAAAAAAAAAAAAAA",
  "status": "IN_PROGRESS",
  "shared_endpoint": ...
  ... : ...,
  "y_point": null,
  "sub_flows": [
    {
      "flow_id": "fAAAAAAAAAAAAAAA",
      "endpoint": {
        "switch_id": "00:00:00:00:00:00:00:02",
        "port_number": 0,
        "vlan_id": 0,
        "inner_vlan_id": 0
      },
      "shared_endpoint": {
        "vlan_id": 0,
        "inner_vlan_id": 0
      },
      "status": "IN_PROGRESS",
      "description": "description",
      "time_create": "YYYY-MM-DDThh:mm:ss[.SSS]",
      "time_update": "YYYY-MM-DDThh:mm:ss[.SSS]"
    },
    {
      "flow_id": "fAAAAAAAAAAAAAAB",
      "endpoint": {
        "switch_id": "00:00:00:00:00:00:00:03",
        "port_number": 0,
        "vlan_id": 0,
        "inner_vlan_id": 0
      },
      "shared_endpoint": {
        "vlan_id": 0,
        "inner_vlan_id": 0
      },
      "status": "IN_PROGRESS",
      "description": "description",
      "time_create": "YYYY-MM-DDThh:mm:ss[.SSS]",
      "time_update": "YYYY-MM-DDThh:mm:ss[.SSS]"
    }
  ],
  "time_create": "YYYY-MM-DDThh:mm:ss[.SSS]",
  "time_update": "YYYY-MM-DDThh:mm:ss[.SSS]",
}
```

## Read operation

REST endpoint: `GET /v2/y-flows/{y_flow_id}`

response payload:

```json
{
  "y_flow_id": "yf-AAAAAAAAAAAAAAA",
  "status": "UP",
  "shared_endpoint": {
    "switch_id": "00:00:00:00:00:00:00:01",
    "port_number": 0
  },
  "maximum_bandwidth": 0,
  "path_computation_strategy": "strategy-name",
  "encapsulation_type": "encapsulation-name",
  "max_latency": 0,
  "max_latency_tier2": 0,
  "ignore_bandwidth": true,
  "periodic_pings": false,
  "pinned": false,
  "priority": 0,
  "strict_bandwidth": true,
  "description": "description",
  "y_point": "00:00:00:00:00:00:01:01",
  "sub_flows": [
    {
      "flow_id": "fAAAAAAAAAAAAAAA",
      "endpoint": {
        "switch_id": "00:00:00:00:00:00:00:02",
        "port_number": 0,
        "vlan_id": 0,
        "inner_vlan_id": 0
      },
      "shared_endpoint": {
        "vlan_id": 0,
        "inner_vlan_id": 0
      },
      "status": "IN_PROGRESS",
      "description": "description",
      "time_create": "YYYY-MM-DDThh:mm:ss[.SSS]",
      "time_update": "YYYY-MM-DDThh:mm:ss[.SSS]"
    },
    {
      "flow_id": "fAAAAAAAAAAAAAAB",
      "endpoint": {
        "switch_id": "00:00:00:00:00:00:00:03",
        "port_number": 0,
        "vlan_id": 0,
        "inner_vlan_id": 0
      },
      "shared_endpoint": {
        "vlan_id": 0,
        "inner_vlan_id": 0
      },
      "status": "IN_PROGRESS",
      "description": "description",
      "time_create": "YYYY-MM-DDThh:mm:ss[.SSS]",
      "time_update": "YYYY-MM-DDThh:mm:ss[.SSS]"
    }
  ],
  "time_create": "YYYY-MM-DDThh:mm:ss[.SSS]",
  "time_update": "YYYY-MM-DDThh:mm:ss[.SSS]",
}
```

`y_point` contain switch_id where flow path's become different. I.e. from "shared_endpoint" to "y_point" all subordinate
flows have same path, from "y_point" to each "endpoint" defined in "flows" array they have independent path's. Can
be `null` if can't be determined (whole y_flow status in this case can't be UP).

`sub_flows` contain info about "second"(not shared) endpoint of subordinate flows. It can contain from 0 to 2 records.

`status` calculated from subordinate flow's statuses. It will `UP` if all subordinate flow statuses are `UP`. It will
be `DEGRADED` if any of subordinate flow status is not `UP`. It will be `DOWN` if there is no one subordinate flow
in `UP` status or there is no any subordinate flow at all. At least one subordinate flow must be `UP` for y_flow start
passing traffic.

## Update operation

Changes will be propagated on all already existing subordinate flows.

REST endpoints: 
 * `PUT /v2/y-flows/{y_flow_id}`
 * `PATCH /v2/y-flows/{y_flow_id}`

Request/response bodies are the same to the create operation. In case of PATCH request only present in request body
fields will be updated.

## Reroute operation

Changes will be propagated on all already existing subordinate flows.

REST endpoint: `POST /v2/y-flows/{y_flow_id}/reroute`

Request body is ignored, response payload:

```json
{
  "rerouted": true,
  "shared_path": {
    "nodes": [
      {
        "port_no": 0,
        "segment_latency": 10,
        "switch_id": "00:00:00:00:00:00:00:04"
      }
    ]
  },
  "sub_flow_paths": [
    {
      "flow_id": "fAAAAAAAAAAAAAAA",
      "nodes": [
        {
          "port_no": 0,
          "segment_latency": 0,
          "switch_id": "00:00:00:00:00:00:00:05"
        }
      ]
    },
    {
      "flow_id": "fAAAAAAAAAAAAAAB",
      "nodes": [
        {
          "port_no": 0,
          "segment_latency": 0,
          "switch_id": "00:00:00:00:00:00:00:06"
        }
      ]
    }
  ]
}
```

## Delete operation

REST endpoint: `DELETE /v2/y-flows/{y_flow_id}`

Request body is ignored, response body is the same to the read operation.

## Read subordinate flows

REST endpoint: `GET /v2/y-flows/{y_flow_id}/flows`

Response body:

```json
{
  "flows": [
    {
      "flow_id": "fAAAAAAAAAAAAAAB",
      "endpoint": {
        "switch_id": "00:00:00:00:00:00:00:03",
        "port_number": 0,
        "vlan_id": 0,
        "inner_vlan_id": 0
      },
      "shared_endpoint": {
        "vlan_id": 0,
        "inner_vlan_id": 0
      },
      "status": "status",
      "description": "description",
      "time_create": "YYYY-MM-DDThh:mm:ss[.SSS]",
      "time_update": "YYYY-MM-DDThh:mm:ss[.SSS]"
    }, {
      "flow_id": "fAAAAAAAAAAAAAAB",
      "endpoint": ...
    }
  ]
}
```

## Read paths

REST endpoint: `GET /v2/y-flows/{y_flow_id}/paths`

Response body:

```json
{
  "shared_path": {
    "nodes": [
      {
        "port_no": 0,
        "segment_latency": 0,
        "switch_id": "00:00:00:00:00:00:00:08"
      }
    ]
  },
  "sub_flow_paths": [
    {
      "flow_id": "fAAAAAAAAAAAAAAA",
      "nodes": [
        {
          "port_no": 0,
          "segment_latency": 0,
          "switch_id": "00:00:00:00:00:00:00:09"
        }
      ]
    },
    {
      "flow_id": "fAAAAAAAAAAAAAAB",
      "nodes": [
        {
          "port_no": 0,
          "segment_latency": 0,
          "switch_id": "00:00:00:00:00:00:00:09"
        }
      ]
    }
  ]
}
```

# Existing API changes

All flows CRUD operation responses will be extended with following fields:

```json
{
  "...": "...",
  "y_flow_id": "yf-AAAAAAAAAAAAAAA",
  "....": "..."
}
```

`y_flow_id` must be not null if the flow is subordinate flow of y_flow.

Update operations for y-flow subordinate flows requested via:

* `PUT /v1/flows/{flow_id}`
* `PUT /v2/flows/{flow_id}`
* `PATCH /v1/flows/{flow_id}`
* `PATCH /v2/flows/{flow_id}`
* `PATCH /v1/flows/{flow_id}/swap`
* `PATCH /v1/flows/{flow_id}/meters`
* `POST /v1/flows/{flow_id}/reroute`
* `POST /v2/flows/{flow_id}/reroute`
* `DELETE /v1/flows`
* `DELETE /v1/flows/{flow_id}`
* `DELETE /v2/flows/{flow_id}`
* `POST /v2/flows/swap-endpoint`
* `POST /v2/flows/{flow_id}/loops`

must be denied.

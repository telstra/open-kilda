@startuml
title Get all flows for a particular link/ISL

participant Client

participant Northbound

control kilda.northbound
control kilda.topo.nb

participant NbWorkerTopology

participant Neo4j

control kilda.flow

participant FlowTopology

Client -> Northbound : GET /link/flows\nRequest params:\nsrc_switch, src_port, dst_switch, dst_port

activate Northbound
Northbound -> kilda.topo.nb : CommandMessage\nGetFlowIdsForLinkRequest
kilda.topo.nb -> NbWorkerTopology : CommandMessage\nGetFlowIdsForLinkRequest
activate NbWorkerTopology
NbWorkerTopology -> Neo4j : Query to get flow ids
activate Neo4j
Neo4j -> NbWorkerTopology : Flow ids
deactivate Neo4j
NbWorkerTopology -> kilda.northbound : InfoData\nFlowsResponse
deactivate NbWorkerTopology
kilda.northbound -> Northbound : InfoData\nFlowsResponse
Northbound -> kilda.flow : CommandMessage\nFlowsDumpRequest
kilda.flow -> FlowTopology : CommandMessage\nFlowsDumpRequest
activate FlowTopology
FlowTopology -> kilda.northbound : InfoData\nFlowReadResponse
deactivate FlowTopology
kilda.northbound -> Northbound : InfoData\nFlowReadResponse
Northbound -> Northbound : Get all flows\nfrom list of FlowPayload\ncontains in FlowsResponse
Northbound -> Client : List of FlowPayload
deactivate Northbound

@enduml
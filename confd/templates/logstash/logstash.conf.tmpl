# Generated by confd.
# Do not change this file, all changes will be lost. Change corresponding template.
input {
  tcp {
    port => {{ getv "/kilda_logging_port_storm" }}
    codec => json
    type => "kilda-storm"
    tags => ["storm-worker_log"]
  }
  tcp {
    port => {{ getv "/kilda_logging_port_grpc" }}
    codec => json
    type => "kilda-grpc"
    tags => ["kilda-grpc"]
  }
  tcp {
    port => {{ getv "/kilda_logging_port_floodlight" }}
    codec => json_lines
    type => "kilda-FL"
    tags => ["kilda-floodlight"]
  }
  tcp {
    port => {{ getv "/kilda_logging_port_lab_service" }}
    codec => json
    type => "kilda-lab-service"
    tags => ["kilda-lab-service"]
  }
  tcp {
    port => {{ getv "/kilda_logging_port_northbound" }}
    codec => json
    type => "kilda-NB"
    tags => ["kilda-northbound"]
  }
  tcp {
      port => {{ getv "/kilda_logging_port_server42_control" }}
      codec => json
      type => "kilda-server42-control"
      tags => ["kilda-server42"]
  }
  tcp {
      port => {{ getv "/kilda_logging_port_server42_control_server_stub" }}
      codec => json
      type => "kilda-server42-control-server-stub"
      tags => ["kilda-server42"]
  }
  tcp {
      port => {{ getv "/kilda_logging_port_server42_control_storm_stub" }}
      codec => json
      type => "kilda-server42-control-storm-stub"
      tags => ["kilda-server42"]
  }
  tcp {
      port => {{ getv "/kilda_logging_port_server42_stats" }}
      codec => json
      type => "kilda-server42-stats"
      tags => ["kilda-server42"]
  }
  tcp {
      port => {{ getv "/kilda_logging_port_tests" }}
      codec => json
      type => "kilda-tests"
      tags => ["kilda-tests"]
  }
}

filter {
  ruby {
    code => "
      event.to_hash.keys.each { |k| event[ k.sub('.','_') ] = event.remove(k) if k.include?'.' }
    "
  }
  mutate {
      rename => { "logger_name" => "loggerName" }
      rename => { "thread_name" => "thread" }
  }
}
output {
  elasticsearch {
    hosts => "{{ getv "/kilda_logging_elasticsearch_hosts" }}"
    index => "{{ getv "/kilda_logging_elasticsearch_index" }}"
  }
}
